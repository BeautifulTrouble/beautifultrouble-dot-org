(function(b){var d=wp.media,c={},a={};c=typeof d.view.l10n.mla_strings==="undefined"?{}:d.view.l10n.mla_strings;delete d.view.l10n.mla_strings;a=typeof wp.media.view.settings.mla_settings==="undefined"?{}:wp.media.view.settings.mla_settings;delete wp.media.view.settings.mla_settings;d.view.AttachmentFilters.Mla=d.view.AttachmentFilters.extend({createFilters:function(){var e={};_.each(a.mimeTypes||{},function(g,f){e[f]={text:g,props:{type:f,uploadedTo:null,orderby:"date",order:"DESC"}}});e.all={text:d.view.l10n.allMediaItems,props:{type:null,uploadedTo:null,orderby:"date",order:"DESC"},priority:10};e.uploaded={text:d.view.l10n.uploadedToThisPost,props:{type:null,uploadedTo:d.view.settings.post.id,orderby:"menuOrder",order:"ASC"},priority:20};this.filters=e}});d.view.AttachmentFilters.MlaMonths=d.view.AttachmentFilters.extend({className:"attachment-months",createFilters:function(){var e={};_.each(a.months||{},function(g,f){e[f]={text:g,props:{m:f,}}});this.filters=e},select:function(){var e=this.model,g="0",f=e.toJSON();_.find(this.filters,function(i,j){var h=_.all(i.props,function(l,k){return l===(_.isUndefined(f[k])?null:f[k])});if(h){return g=j}});this.$el.val(g)}});d.view.AttachmentFilters.MlaTerms=d.view.AttachmentFilters.extend({className:"attachment-terms",createFilters:function(){var e={};_.each(a.termsText||{},function(g,f){e[f]={text:g,props:{mla_filter_term:parseInt(a.termsValue[f]),}}});this.filters=e},select:function(){var e=this.model,g="0",f=e.toJSON();_.find(this.filters,function(i,j){var h=_.all(i.props,function(l,k){return l===(_.isUndefined(f[k])?null:f[k])});if(h){return g=j}});this.$el.val(g)}});d.view.MlaSearch=d.View.extend({tagName:"div",className:"mla-search-box",template:d.template("mla-search-box"),attributes:{type:"mla-search-box",placeholder:c.searchBoxPlaceholder},events:{change:"search",click:"search",search:"search",MlaSearch:"search"},render:function(){this.$el.html(this.template());return this},search:function(e){if(("click"==e.type)&&("mla_search_submit"!=e.target.name)){return}switch(e.target.name){case"mla_search_value":a.searchValue=e.target.value;case"mla_search_submit":this.model.set({s:a.searchValue+a.searchFields+a.searchConnector,mla_search_value:a.searchValue,mla_search_fields:a.searchFields,mla_search_connector:a.searchConnector});break;case"mla_search_connector":a.searchConnector=e.target.value;break;case"mla_search_title":index=a.searchFields.indexOf("title");if(-1==index){a.searchFields.push("title")}else{a.searchFields.splice(index,1)}break;case"mla_search_name":index=a.searchFields.indexOf("name");if(-1==index){a.searchFields.push("name")}else{a.searchFields.splice(index,1)}break;case"mla_search_alt_text":index=a.searchFields.indexOf("alt-text");if(-1==index){a.searchFields.push("alt-text")}else{a.searchFields.splice(index,1)}break;case"mla_search_excerpt":index=a.searchFields.indexOf("excerpt");if(-1==index){a.searchFields.push("excerpt")}else{a.searchFields.splice(index,1)}break;case"mla_search_content":index=a.searchFields.indexOf("content");if(-1==index){a.searchFields.push("content")}else{a.searchFields.splice(index,1)}break}}});d.view.AttachmentsBrowser=d.view.AttachmentsBrowser.extend({createToolbar:function(){var f,e;d.model.Query.defaultArgs.mla_source="MLA";if(a.enableSearchBox){d.model.Query.defaultArgs.mla_search_value=a.searchValue;d.model.Query.defaultArgs.mla_search_fields=a.searchFields;d.model.Query.defaultArgs.mla_search_connector=a.searchConnector}this.toolbar=new d.view.Toolbar({controller:this.controller});this.views.add(this.toolbar);f=this.options.filters;if("uploaded"===f){e=d.view.AttachmentFilters.Uploaded}else{if("all"===f){if(a.enableMimeTypes){e=d.view.AttachmentFilters.Mla}else{e=d.view.AttachmentFilters.All}}}if(e){this.toolbar.set("filters",new e({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(f&&a.enableMonthsDropdown){this.toolbar.set("months",new d.view.AttachmentFilters.MlaMonths({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(f&&a.enableTermsDropdown){this.toolbar.set("terms",new d.view.AttachmentFilters.MlaTerms({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(this.options.search){if(a.enableSearchBox){this.toolbar.set("MlaSearch",new d.view.MlaSearch({controller:this.controller,model:this.collection.props,priority:60}).render())}else{this.toolbar.set("search",new d.view.Search({controller:this.controller,model:this.collection.props,priority:60}).render())}}if(this.options.dragInfo){this.toolbar.set("dragInfo",new d.View({el:b('<div class="instructions">'+d.view.l10n.dragInfo+"</div>")[0],priority:-40}))}}})}(jQuery));